<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chat-o-llama ğŸ¦™</title>
    
    <!-- External CSS Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    
    <!-- Local CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/speech.css') }}">
    
    <!-- External JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/5.1.1/marked.min.js"></script>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="app-title">chat-o-llama ğŸ¦™</div>
            <div class="app-title-collapsed" id="appTitleCollapsed">ğŸ¦™</div>
            <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle sidebar">â€¹</button>
            
            <!-- Mode Toggle -->
            <div class="mode-toggle-container">
                <button class="mode-toggle" id="normalModeBtn" onclick="switchToNormalMode()" title="Normal Chat Mode">ğŸ’¬</button>
                <button class="mode-toggle active" id="tutoringModeBtn" onclick="switchToTutoringMode()" title="Tutoring Mode">ğŸ“</button>
            </div>
            
            <button class="new-chat-btn" onclick="createNewChat()">+ New Chat</button>
            
            <!-- Consolidated backend selector with status -->
            <div class="backend-section">
                <div class="backend-dropdown-container">
                    <div class="backend-current" id="backendCurrent" onclick="toggleBackendDropdown()">
                        <span class="backend-indicator" id="backendIndicator">ğŸ”„</span>
                        <span class="backend-text" id="backendText">Loading...</span>
                        <span class="backend-chevron">â–¼</span>
                    </div>
                    <div class="backend-dropdown" id="backendDropdown">
                        <div class="backend-options" id="backendOptions">
                            <!-- Backend options will be populated here -->
                        </div>
                        <div class="backend-refresh-container">
                            <button class="backend-refresh" id="backendRefresh" onclick="refreshBackendStatus()" title="Refresh backend status">â†» Refresh Status</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <select class="model-select" id="modelSelect">
                <option value="">Loading models...</option>
            </select>
        </div>
        <div class="conversations-list" id="conversationsList">
            <!-- Conversations will be loaded here -->
        </div>
    </div>

    <div class="main-content">
        <div class="chat-header">
            <div class="chat-title" id="chatTitle" onclick="deselectConversation()" style="cursor: pointer;" title="Click to return to main screen">Select a conversation</div>
            <div style="position: relative;">
                <input type="text" class="search-box" id="searchBox" placeholder="Search conversations..." onkeyup="searchConversations(event)">
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="no-conversation" id="noConversation">
                <h2>Welcome to chat-o-llama</h2>
                <p>Create a new chat to get started</p>
            </div>
            
            <!-- Tutoring Mode Welcome -->
            <div class="tutoring-welcome" id="tutoringWelcome" style="display: none;">
                <h2>ğŸ“ LearnLM Tutoring Mode</h2>
                <p>I'm here to help you learn through guided discovery and active engagement!</p>
                
                <div class="tutoring-categories">
                    <h3>How I can help you:</h3>
                    <div class="category-grid">
                        <div class="category-card" onclick="startTutoringCategory('GUIDANCE')">
                            <div class="category-icon">ğŸ¯</div>
                            <div class="category-name">Study Guidance</div>
                            <div class="category-desc">Learning strategies and study advice</div>
                        </div>
                        <div class="category-card" onclick="startTutoringCategory('NEW_TOPIC')">
                            <div class="category-icon">ğŸ“š</div>
                            <div class="category-name">Learn New Topic</div>
                            <div class="category-desc">Explore new concepts step-by-step</div>
                        </div>
                        <div class="category-card" onclick="startTutoringCategory('HOMEWORK_HELP')">
                            <div class="category-icon">ğŸ“</div>
                            <div class="category-name">Homework Help</div>
                            <div class="category-desc">Guided problem-solving assistance</div>
                        </div>
                        <div class="category-card" onclick="startTutoringCategory('ASSESSMENT')">
                            <div class="category-icon">ğŸ“</div>
                            <div class="category-name">Assessment</div>
                            <div class="category-desc">Test your understanding</div>
                        </div>
                    </div>
                </div>
                
                <div class="tutoring-principles">
                    <h4>ğŸŒŸ My Teaching Approach:</h4>
                    <ul>
                        <li>âœ¨ I guide you to discover answers rather than giving them directly</li>
                        <li>ğŸ¤” I ask questions to help you think critically</li>
                        <li>ğŸ“ I encourage you to show your thinking process</li>
                        <li>ğŸ¯ I adapt to your learning pace and style</li>
                        <li>ğŸ’¡ I help you connect new knowledge to what you already know</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="input-container" id="inputContainer" style="display: none;">
            <textarea class="message-input" id="messageInput" placeholder="Type your message..." rows="1" onkeydown="handleKeyDown(event)" oninput="autoResize(this)"></textarea>
            <div class="speech-controls">
                <div class="speech-language-selector">
                    <select class="speech-language-select" id="speechLanguageSelect" title="Speech recognition language">
                        <option value="auto">Auto</option>
                        <option value="en">EN</option>
                        <option value="es">ES</option>
                        <option value="fr">FR</option>
                        <option value="de">DE</option>
                        <option value="zh">ZH</option>
                        <option value="ja">JA</option>
                        <option value="ru">RU</option>
                    </select>
                </div>
                <button class="speech-button" id="speechButton" onclick="toggleSpeechRecording()" title="Voice input">
                    ğŸ¤
                    <div class="speech-tooltip">Click to record voice</div>
                </button>
                <div class="audio-visualizer" id="audioVisualizer">
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                </div>
            </div>
            <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <!-- Copy notification -->
    <div class="copy-notification" id="copyNotification">Copied to clipboard!</div>
    
    <!-- Speech status indicator -->
    <div class="speech-status" id="speechStatus">
        <span class="status-icon">ğŸ¤</span>
        <span class="status-text">Listening...</span>
    </div>

    <!-- Local JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/speech.js') }}"></script>
</body>
</html>